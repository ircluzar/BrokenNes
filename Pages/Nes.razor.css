:root {
  --nes-bg:#0d0f13;
  --nes-panel:#161b22;
  --nes-border:#262f3d;
  --nes-accent:#4fa3ff;
  --nes-accent-glow:#4fa3ff55;
  --nes-radius:14px;
  --nes-radius-sm:8px;
  --nes-gap:1rem;
  --shadow-elev:0 4px 12px -2px rgba(0,0,0,.4),0 2px 4px -1px rgba(0,0,0,.3);
}

.nes-page-header .page-title { font-size:clamp(1.5rem,5vw,2.25rem); letter-spacing:1px; font-weight:600; }
.nes-page-header .subtitle { letter-spacing:.5px; }

.nes-grid { display:grid; gap:var(--nes-gap); align-items:start; }

/* Mobile first: single column layout */
@media (max-width: 899px) {
  .nes-grid { 
    grid-template-columns: 1fr !important; 
    gap: 0.75rem;
    margin: 0;
    padding: 0;
  }
  .play-area, .side-panels { 
    width: 100%; 
    max-width: 100%; 
    margin: 0;
    padding: 0;
  }
  .side-panels { 
    position: static; 
    top: auto; 
    max-height: none; 
    padding-right: 0; 
  }
}

@media (min-width: 900px){
  /* Desktop: widen ROM manager slightly */
  .nes-grid { grid-template-columns:minmax(0,1fr) minmax(420px,560px); }
  .side-panels { position:sticky; top:0.75rem; align-self:start; max-height:calc(100dvh - 2rem); overflow:auto; padding-right:0.25rem; }
}
@media (min-width: 1300px){
  /* Extra wide: give ROM manager even more breathing room while keeping play area priority */
  .nes-grid { grid-template-columns:minmax(0,1fr) minmax(520px,640px); }
}

.play-area { display:flex; flex-direction:column; align-items:center; width: 100%; max-width: 100%; box-sizing: border-box; }
.screen-shell { 
  background:linear-gradient(145deg,#111822,#0b0f15); 
  padding:clamp(.6rem,2vw,1.1rem); 
  border-radius:var(--nes-radius); 
  box-shadow:var(--shadow-elev); 
  border:1px solid #1f2730; 
  width:100%; 
  max-width:720px; 
  box-sizing: border-box; 
}

/* Default hide mobile fullscreen view bar & extra views outside portrait mobile fullscreen */
#mobile-fs-view-bar { display:none; }
.mobile-fs-extra-views { display:none; }
/* Spacing below tab bar inside fullscreen portrait */
.mobile-fs-active #mobile-fs-view-bar { margin:0; }
.mobile-fs-active .mobile-fs-extra-views { margin-top:0.35rem; }
/* Ensure embedded controller view aligns with other mobile views */
.mobile-fs-active .controller-view { background:#11161d; border:1px solid #1f2731; border-radius:12px; padding:0.4rem 0.5rem 0.65rem; }

/* Override max-width for narrow screens */
@media (max-width: 480px) {
  .screen-shell {
    max-width: 100% !important;
    width: 100% !important;
  }
}
.screen-aspect { 
  position:relative; 
  aspect-ratio: 256/240; 
  width:100%; 
  background:#000; 
  display:flex; 
  align-items:center; 
  justify-content:center; 
  overflow:hidden; 
  border-radius:var(--nes-radius-sm); 
}
.screen-aspect canvas { width:100%; height:100%; object-fit:contain; image-rendering:pixelated; max-width: 100%; }

/* Ultra-narrow screen fixes for canvas */
@media (max-width: 380px) {
  .screen-aspect {
    width: 100% !important;
    max-width: 100% !important;
  }
  
  .screen-aspect canvas {
    width: 100% !important;
    max-width: 100% !important;
    height: auto !important;
  }
}
.overlay-status { display:flex; align-items:center; justify-content:space-between; gap:.35rem; pointer-events:none; margin-bottom:.35rem; font-size:.6rem; line-height:1.1; }
.overlay-status .badges { pointer-events:none; }
.overlay-status.small { font-size:.55rem; }
.overlay-actions { display:flex; gap:.3rem; pointer-events:auto; margin-left:auto; }
.overlay-actions .ov-btn { background:#1e2731; border:1px solid #2c3947; color:#e6edf3; font-size:.55rem; line-height:1; padding:.28rem .45rem; border-radius:5px; cursor:pointer; font-weight:600; min-width:28px; display:inline-flex; align-items:center; justify-content:center; }
.overlay-actions .ov-btn:hover { background:#273341; }
.overlay-actions .ov-btn.active { background:var(--nes-accent); border-color:var(--nes-accent); color:#0d1117; box-shadow:0 0 0 3px var(--nes-accent-glow); }
.overlay-actions .ov-btn:active { transform:translateY(1px); }

.quick-controls .btn-group .btn { min-width:70px; }

/* Custom save/load button tints */
/* Unified dark-outline style buttons (RF/FMC + Save/Load) */
.quick-controls .btn-rf,
.quick-controls .btn-fmc,
.quick-controls .btn-save-state,
.quick-controls .btn-load-state { 
  background:#0d1117; 
  font-weight:600; 
  letter-spacing:.5px;
  position:relative;
  transition:.18s background, .18s color, .18s box-shadow, .18s border-color;
}
/* RF toggle (shader) */
.quick-controls .btn-rf { 
  border:1px solid #4fa3ff; 
  color:#4fa3ff; 
}
.quick-controls .btn-rf:hover:not(:disabled),
.quick-controls .btn-rf:focus-visible { 
  background:#13202c; 
  box-shadow:0 0 0 3px rgba(79,163,255,.35); 
}
.quick-controls .btn-rf:active:not(:disabled) { filter:brightness(1.1); }

/* Famiclone toggle */
.quick-controls .btn-fmc { 
  border:1px solid #3ec6e2; 
  color:#3ec6e2; 
}
.quick-controls .btn-fmc:hover:not(:disabled),
.quick-controls .btn-fmc:focus-visible { 
  background:#102228; 
  box-shadow:0 0 0 3px rgba(62,198,226,.35); 
}
.quick-controls .btn-fmc:active:not(:disabled) { filter:brightness(1.12); }

/* Save State (more orangered) */
.quick-controls .btn-save-state { 
  border:1px solid #ff5a26; 
  color:#ff7546; 
  box-shadow:0 0 0 0 rgba(255,90,38,0); 
}
.quick-controls .btn-save-state:hover:not(:disabled),
.quick-controls .btn-save-state:focus-visible { 
  background:#19120f; 
  color:#ff5a26; 
  border-color:#ff5a26; 
  box-shadow:0 0 0 3px rgba(255,90,38,.35); 
}
.quick-controls .btn-save-state:active:not(:disabled) { filter:brightness(1.12); }
.quick-controls .btn-save-state:disabled { opacity:.45; filter:grayscale(.3); }

/* Load State (brighter yellow) */
.quick-controls .btn-load-state { 
  border:1px solid #ffd84d; 
  color:#ffe48a; 
  box-shadow:0 0 0 0 rgba(255,216,77,0); 
}
.quick-controls .btn-load-state:hover:not(:disabled),
.quick-controls .btn-load-state:focus-visible { 
  background:#18150c; 
  color:#ffd84d; 
  border-color:#ffd84d; 
  box-shadow:0 0 0 3px rgba(255,216,77,.35); 
}
.quick-controls .btn-load-state:active:not(:disabled) { filter:brightness(1.1); }
.quick-controls .btn-load-state:disabled { opacity:.45; filter:grayscale(.3); }

/* New view controls (scale + fullscreen) */
.view-controls .btn-group .btn { min-width:70px; }
.desktop-only { display:inline-flex; }
@media (max-width: 899px){
  .desktop-only { display:none !important; }
}

/* Scaling for desktop shell */
.screen-shell.scale-50 .screen-aspect { max-width:360px; margin:0 auto; }
.screen-shell.scale-100 .screen-aspect { max-width:100%; }

/* Fullscreen desktop */
.fs-desktop-active { position:fixed !important; inset:0; margin:0 !important; padding:0 !important; z-index:9999; background:#000; display:flex; flex-direction:column; align-items:center; justify-content:center; }
/* Center letterboxed scaling: compute max size based on viewport while keeping 256:240 */
.fs-desktop-active .screen-aspect { 
  width:100%;
  max-width:calc(100vh * (256 / 240));
  height:auto;
}
@media (aspect-ratio > 256/240) { /* taller than needed, limit by width */
  .fs-desktop-active .screen-aspect { max-width:100%; }
}

/* Mobile portrait fullscreen layout */
@media (max-width: 899px) and (orientation: portrait){
  /* Reduced bottom padding to remove large gap; dynamic JS may further tweak when switching views */
  .mobile-fs-active { position:fixed !important; inset:0; background:#000; z-index:9999; display:flex; flex-direction:column; align-items:center; justify-content:flex-start; padding:0.25rem 0.25rem 1.25rem; overflow:hidden; }
  .mobile-fs-active .screen-shell { background:transparent; box-shadow:none; border:none; width:100% !important; max-width:100% !important; padding:0 0 0.35rem !important; }
  .mobile-fs-active .screen-aspect { width:100%; max-width:100%; height:auto; aspect-ratio:256/240; }
  /* View switch bar */
  /* Previously fixed at bottom; now placed inline between the viewport and dynamic panel/controller for better reachability. */
  #mobile-fs-view-bar { 
    position:relative; 
    display:none; 
    width:100%;
    gap:0.4rem; 
    padding:0.45rem 0.6rem 0.35rem; 
    background:transparent; 
    z-index:5; 
    box-sizing:border-box;
  }
  .mobile-fs-active #mobile-fs-view-bar { display:flex; }
  #mobile-fs-view-bar .view-btn { flex:1 1 0; font-size:0.65rem; letter-spacing:.5px; font-weight:600; background:#1d2530; border:1px solid #2d3743; color:#d6e2ea; padding:0.55rem 0.4rem; border-radius:9px; box-shadow:0 2px 4px -1px #000a; }
  #mobile-fs-view-bar .view-btn.active { background:var(--nes-accent); border-color:var(--nes-accent); color:#041019; box-shadow:0 0 0 3px var(--nes-accent-glow); }
  #mobile-fs-view-bar .view-btn:active { transform:translateY(1px); }
  /* Extra views container now always visible below tab bar; controller view also rendered here so we don't hide container. */
  .mobile-fs-active .mobile-fs-extra-views { display:block; width:100%; max-width:100%; padding:0.15rem 0.4rem 0.5rem; overflow-y:auto; -webkit-overflow-scrolling:touch; flex:1 1 auto; box-sizing:border-box; }
  .mobile-fs-active .mobile-fs-extra-views .mobile-view { background:#11161d; border:1px solid #1f2731; border-radius:12px; padding:0.65rem 0.75rem 0.9rem; box-shadow:0 4px 10px -2px #000a; }
  .mobile-fs-active .mobile-fs-extra-views .mobile-view select,
  .mobile-fs-active .mobile-fs-extra-views .mobile-view input,
  .mobile-fs-active .mobile-fs-extra-views .mobile-view button { font-size:0.65rem; }
  .mobile-fs-active .mobile-fs-extra-views .gh-list { max-height:160px; overflow:auto; }
  /* === Touch Controller Layout (NES style) === */
  #touch-controller { width:100%; flex:0 0 auto; padding:0.6rem 0.65rem 0.35rem; display:flex; flex-direction:column; gap:0.55rem; max-width:100%; box-sizing:border-box; z-index:10000; }
  #touch-controller .controller-grid { display:flex; flex-direction:column; width:100%; gap:0.55rem; }
  #touch-controller .upper-row { display:flex; justify-content:space-between; align-items:flex-end; gap:1.35rem; }
  /* D-Pad cross */
  #touch-controller .dpad { position:relative; width:min(40vw,240px); aspect-ratio:1/1; max-width:240px; }
  #touch-controller .dpad .pad-btn { position:absolute; background:#1c2530; border:1px solid #2f3d4b; color:#e6eef5; border-radius:14px; font-size:0.8rem; font-weight:600; display:flex; align-items:center; justify-content:center; box-shadow:0 2px 4px rgba(0,0,0,.5); user-select:none; -webkit-user-select:none; }
  #touch-controller .dpad .pad-btn[data-btn=up] { top:0; left:35%; right:35%; height:29%; }
  #touch-controller .dpad .pad-btn[data-btn=down] { bottom:0; left:35%; right:35%; height:29%; }
  #touch-controller .dpad .pad-btn[data-btn=left] { left:0; top:35%; bottom:35%; width:29%; }
  #touch-controller .dpad .pad-btn[data-btn=right] { right:0; top:35%; bottom:35%; width:29%; }
  #touch-controller .dpad .center-dot { position:absolute; top:35%; left:35%; right:35%; bottom:35%; background:#10171f; border:1px solid #2a3949; border-radius:12px; box-shadow:inset 0 0 4px #000; pointer-events:none; }
  /* Center start/select */
  /* Start / Select row */
  #touch-controller .start-select-row { display:flex; justify-content:center; gap:1.5rem; }
  #touch-controller .start-select-row .small-btn { background:#262e37; border:1px solid #3a4653; color:#d9e4ec; padding:0.55rem 1.1rem; font-size:0.6rem; border-radius:28px; letter-spacing:1px; font-weight:600; min-width:88px; text-align:center; box-shadow:0 2px 5px rgba(0,0,0,.45); }
  @media (max-width:480px){
    #touch-controller .start-select-row { gap:0.9rem; }
    #touch-controller .start-select-row .small-btn { min-width:74px; padding:0.5rem 0.85rem; font-size:0.55rem; }
  }
  /* System buttons row */
  #touch-controller .system-row { display:flex; justify-content:center; gap:0.9rem; }
  #touch-controller .system-row .sys-btn { background:#1d242c; border:1px solid #33404d; color:#d8e2ea; padding:0.5rem 0.85rem; font-size:0.55rem; border-radius:10px; letter-spacing:.5px; font-weight:600; min-width:72px; }
  #touch-controller .system-row .sys-btn:active { filter:brightness(1.25); }
  /* A/B angled cluster */
  #touch-controller .actions { position:relative; width:min(46vw,280px); max-width:280px; height:min(34vw,210px); max-height:210px; display:flex; align-items:center; justify-content:center; }
  #touch-controller .actions .ab-cluster { position:relative; width:100%; height:100%; }
  #touch-controller .actions .ab-cluster .btn-a,
  #touch-controller .actions .ab-cluster .btn-b { position:absolute; width:38%; aspect-ratio:1/1; background:#3b2439; border:1px solid #7a4669; color:#f5e9f3; font-weight:700; font-size:1.05rem; border-radius:50%; display:flex; align-items:center; justify-content:center; box-shadow:0 5px 12px -3px #000c, inset 0 0 6px #0007; transition:.08s; }
  /* Increased separation */
  #touch-controller .actions .ab-cluster .btn-b { left:8%; bottom:24%; }
  #touch-controller .actions .ab-cluster .btn-a { right:8%; top:18%; transform:rotate(-8deg); }
  #touch-controller .actions .ab-cluster .btn-a:active, #touch-controller .actions .ab-cluster .btn-b:active { transform:scale(.94); }
  /* Interaction states */
  #touch-controller .pad-btn:active, #touch-controller .small-btn:active { filter:brightness(1.25); }
  #touch-controller .pressed { outline:2px solid var(--nes-accent); box-shadow:0 0 0 4px var(--nes-accent-glow); }
  /* Narrow device tweaks */
  @media (max-width:480px){
  #touch-controller { padding:0.45rem 0.45rem 0.25rem; }
  #touch-controller .upper-row { gap:0.8rem; }
  #touch-controller .dpad { width:54vw; }
  #touch-controller .actions { width:48vw; }
  #touch-controller .start-select-row { gap:0.75rem; }
  #touch-controller .system-row { gap:0.65rem; }
  }
  body.mobile-no-scroll, html.mobile-no-scroll { overflow:hidden !important; height:100%; touch-action:none; }
  #mobile-fs-bottom-bar { position:fixed; left:0; right:0; bottom:0; background:rgba(15,15,18,0.95); backdrop-filter:blur(6px); display:flex; gap:0.5rem; padding:0.55rem 0.75rem; justify-content:space-around; z-index:10000; }
  #mobile-fs-bottom-bar .btn { flex:1 1 0; font-size:0.75rem; padding:0.55rem 0.4rem; }
}

/* Fallback NES touch controller layout (applies even if orientation detection fails) */
@media (max-width: 899px){
  .mobile-fs-active #touch-controller { width:100%; }
  /* Pressed + interaction states retained */
  .mobile-fs-active #touch-controller .pressed { outline:2px solid var(--nes-accent); box-shadow:0 0 0 4px var(--nes-accent-glow); }
  .mobile-fs-active #touch-controller .small-btn:active, .mobile-fs-active #touch-controller .pad-btn:active { filter:brightness(1.25); }
}

/* Mobile controls adjustments */
@media (max-width: 640px) {
  .quick-controls { 
    gap: 0.5rem; 
    width: 100%; 
    justify-content: center;
  }
  .quick-controls .btn-group { 
    flex-wrap: wrap; 
    gap: 0.25rem; 
  }
  .quick-controls .btn-group .btn { 
    min-width: 60px; 
    font-size: 0.7rem; 
    padding: 0.4rem 0.6rem; 
  }
}

/* Ultra-narrow screens (modern phones in portrait) */
@media (max-width: 380px) {
  .quick-controls .btn-group .btn { 
    min-width: 45px !important; 
    font-size: 0.6rem; 
    padding: 0.3rem 0.4rem; 
  }
}

/* Corruptor (moved into collapsible side panel) */
.corruptor-panel .panel-content { padding-top:.5rem; }
.corruptor-panel .intensity-box { width:110px; }
.corruptor-panel select[multiple] { font-family: ui-monospace, monospace; }

.status-bar { display:flex; flex-wrap:wrap; gap:.5rem; justify-content:center; margin-top:1rem; }
.status-chip { background:var(--nes-panel); border:1px solid var(--nes-border); padding:.35rem .75rem; border-radius:999px; font-size:.7rem; letter-spacing:.5px; text-transform:uppercase; box-shadow:0 1px 2px rgba(0,0,0,.5); }

.side-panels details { 
  background:var(--nes-panel); 
  border:1px solid var(--nes-border); 
  border-radius:var(--nes-radius-sm); 
  box-shadow:var(--shadow-elev); 
  margin-bottom:var(--nes-gap); 
  overflow:hidden; 
  width: 100%;
  max-width: 100%;
  box-sizing: border-box;
}
.side-panels details[open] { animation:panelFade .35s ease; }
.side-panels summary { 
  cursor:pointer; 
  list-style:none; 
  padding:.7rem 1rem; 
  font-weight:600; 
  font-size:.9rem; 
  position:relative; 
  word-wrap: break-word;
}
.side-panels summary::-webkit-details-marker { display:none; }
.side-panels summary:after { 
  content:""; 
  position:absolute; 
  right:1rem; 
  top:50%; 
  translate:0 -50%; 
  width:.75rem; 
  height:.75rem; 
  mask:linear-gradient(#000,#000); 
  background:var(--nes-accent); 
  clip-path:polygon(50% 65%,15% 30%,85% 30%); 
  transition:.25s; 
  opacity:.8; 
}
.side-panels details[open] summary:after { rotate:180deg; }
.side-panels .panel-content { 
  padding:.75rem 1rem 1rem; 
  font-size:.8rem; 
  width: 100%;
  box-sizing: border-box;
  overflow-x: auto;
}
.key-grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(120px,1fr)); gap:.4rem .75rem; }
.debug-mini { display:grid; gap:.25rem; font-size:.7rem; }
.debug-mini button { font-size:.65rem; }

.rom-drop-zone { background:rgba(255,255,255,.03); transition:.25s; }
.rom-drop-zone:hover { background:rgba(255,255,255,.07); }

/* ROM table row interactions */
table.rom-table tbody tr { cursor:pointer; transition:background .15s, color .15s; }
table.rom-table tbody tr:hover { background:#253344; }
table.rom-table tbody tr.table-primary:hover { background:#2d4d70; }

/* Mobile ROM table adjustments */
@media (max-width: 640px) {
  table.rom-table {
    font-size: 0.7rem;
  }
  
  table.rom-table th,
  table.rom-table td {
    padding: 0.3rem 0.5rem;
  }
  
  .table-responsive {
    max-height: 200px !important;
  }
  
  table.rom-table tbody td {
    word-break: break-word;
  }
  
  table.rom-table .btn {
    padding: 0.2rem 0.4rem;
    font-size: 0.6rem;
  }
}

/* Drag-over subtle glow when dropping ROMs directly on table */
#rom-table.drag-over, table.rom-table.drag-over {
  outline:2px solid var(--nes-accent);
  box-shadow:0 0 0 3px var(--nes-accent-glow), 0 0 14px -2px var(--nes-accent);
  transition:box-shadow .25s, outline-color .25s;
}

/* Scrollbar subtle styling */
.side-panels { scrollbar-width:thin; scrollbar-color:#39495e #111b27; }
.side-panels::-webkit-scrollbar { width:10px; }
.side-panels::-webkit-scrollbar-track { background:#111b27; }
.side-panels::-webkit-scrollbar-thumb { background:#2b394b; border-radius:6px; border:2px solid #111b27; }
.side-panels::-webkit-scrollbar-thumb:hover { background:#35506a; }

@keyframes panelFade { from { opacity:0; translate:0 4px; } to { opacity:1; translate:0 0;} }

/* Responsive tweaks */
@media (max-width:599px){
  .quick-controls .btn { 
    padding:.35rem .5rem; 
    font-size:.7rem; 
    margin: 0.1rem;
  }
  .quick-controls, .btn-toolbar, .btn-group { width:100% !important; max-width:100vw !important; }
  /* legacy corruptor card no longer used; panel inherits responsiveness */
  
  /* Better spacing for narrow screens */
  .nes-grid {
    gap: 0.5rem;
  }
  
  .screen-shell {
    padding: 0.4rem;
  }
  
  /* Adjust corruptor layout for mobile */
  .card.corruptor .row {
    margin: 0;
  }
  
  .card.corruptor .col-12,
  .card.corruptor .col-sm-5,
  .card.corruptor .col-sm-7 {
    padding: 0.25rem;
  }
  
  .card.corruptor .form-select,
  .card.corruptor .form-control {
    font-size: 0.75rem;
  }
}

/* ================= Accessibility / Readability Tweaks ================= */
/* Lighten muted / secondary style text inside this page for dark background */
.text-muted, .text-secondary { color:#b8c4cf !important; }
/* Overlay FPS + status badges: make readable on near-black */
.overlay-status .badge { background:#1e2731 !important; color:#e6edf3 !important; border:1px solid #2c3947; font-weight:500; padding:.15rem .4rem; font-size:.55rem; line-height:1; border-radius:4px; }
.badge.bg-dark-subtle, .badge.bg-dark-subtle.text-dark { background:#1e2731 !important; color:#e6edf3 !important; }
/* Table header contrast */
table.rom-table thead { background:#2b3947 !important; color:#f0f4f8 !important; }
table.rom-table thead th { border-color:#3a4a59 !important; }
/* Status chips: slightly brighter text */
.status-chip { color:#d2d9df; }

/* ================= Mobile / Portrait Layout Fixes ================= */
/* Universal mobile adjustments (all mobile devices) */
@media (max-width: 680px) { /* broaden slightly to catch edge devices */
  .nes-grid { 
    grid-template-columns: 1fr !important; 
    gap: 0.75rem;
    padding: 0;
    margin: 0;
  }
  
  .play-area { 
    width: 100%; 
    max-width: 100%; 
    padding: 0;
    margin: 0;
  }
  
  .screen-shell { 
    margin: 0;
    padding: 0.5rem;
    max-width: 100%;
    width: 100%;
  }
  
  .side-panels { 
    position: static; 
    top: auto; 
    max-height: none; 
    padding-right: 0; 
    width: 100%;
    max-width: 100%;
  }
  
  .side-panels details { 
    margin-bottom: 0.75rem; 
  }
  
  .status-bar { 
    font-size: 0.6rem; 
    justify-content: center;
    gap: 0.5rem;
  }
  
  .status-chip { 
    padding: 0.25rem 0.5rem; 
    font-size: 0.6rem; 
  }
  
  /* Clamp any potentially overflowing blocks */
  .nes-grid, .play-area, .screen-shell, .screen-aspect, .quick-controls, .side-panels, .card.corruptor, .panel-content, .status-bar, .btn-toolbar, .btn-group { max-width:100vw; }

  /* Fix Bootstrap gap classes on mobile */
  .gap-2 {
    gap: 0.5rem !important;
  }
  
  .btn-toolbar {
    flex-wrap: wrap !important;
    width: 100% !important;
    justify-content: center !important;
    margin:0 !important;
  }

  .table-responsive { width:100%; max-width:100vw; overflow-x:auto; }
  table.rom-table { table-layout:fixed; width:100%; }
  table.rom-table td, table.rom-table th { overflow:hidden; text-overflow:ellipsis; }
}

/* Tablet landscape adjustments */
@media (max-width: 820px) and (min-width: 641px) {
  .nes-grid { 
    grid-template-columns: 1fr !important; 
  }
  
  .play-area, .side-panels { 
    width: 100%; 
    max-width: 100%; 
  }
  
  .side-panels { 
    position: static; 
    top: auto; 
    max-height: none; 
    padding-right: 0; 
  }
  
  .screen-shell { 
    margin: 0 auto; 
  }
  
  .nes-grid { 
    gap: 0.85rem; 
  }
}

/* Portrait specific fixes */
@media (max-width: 640px) and (orientation: portrait) {
  .screen-shell { 
    padding: 0.4rem; 
  }
  
  /* legacy corruptor card removed */
  
  .side-panels details { 
    margin-bottom: 0.75rem; 
  }
  
  .rom-drop-zone { 
    font-size: 0.75rem; 
  }
  
  .quick-controls {
    flex-direction: column;
    gap: 0.5rem;
  }
  
  .quick-controls .btn-toolbar {
    width: 100%;
    justify-content: center;
  }
  
  .overlay-status {
    font-size: 0.7rem;
  }
}

/* Very small screens */
@media (max-width: 520px) { /* widened threshold */
  .screen-shell {
    padding: 0.3rem;
    max-width: 100% !important;
  }
  .quick-controls, .btn-toolbar, .btn-group, .status-bar { width:100% !important; max-width:100vw !important; }
  
  .quick-controls .btn {
    font-size: 0.6rem;
    padding: 0.3rem 0.5rem;
    min-width: 45px !important;
  }
  
  .corruptor-panel .panel-content { padding:0.75rem 1rem 1rem; }
  
  .form-control, .form-select {
    font-size: 0.8rem;
    padding: 0.4rem 0.6rem;
  }
  
  /* ROM manager mobile improvements */
  .side-panels .panel-content .d-flex {
    flex-wrap: wrap;
    gap: 0.25rem;
  }
  
  .side-panels .panel-content .form-control {
    min-width: 100px !important;
  }
  
  .side-panels .panel-content .btn {
    padding: 0.3rem 0.5rem;
    font-size: 0.65rem;
  }
  
  /* Mobile table fixes */
  .table-responsive {
    font-size: 0.65rem;
  }
  
  table.rom-table th:nth-child(3),
  table.rom-table td:nth-child(3) {
    width: 60px !important;
  }
  
  table.rom-table th:nth-child(4),
  table.rom-table td:nth-child(4) {
    width: 70px !important;
  }
  
  table.rom-table th:nth-child(5),
  table.rom-table td:nth-child(5) {
    width: 50px !important;
  }
}

/* Ultra-narrow screens (modern high-DPI phones like Pixel) */
@media (max-width: 420px) {
  /* Force container overrides */
  * {
    min-width: 0 !important;
  }
  
  .container, .container-fluid {
    padding-left: 0.25rem !important;
    padding-right: 0.25rem !important;
  }
  
  .screen-shell {
    padding: 0.2rem !important;
    margin: 0 !important;
  }
  
  .nes-grid {
    gap: 0.4rem !important;
    padding: 0 !important;
    margin: 0 !important;
  }
  
  /* Fix button toolbar overflow */
  .btn-toolbar { gap:0.25rem !important; width:100% !important; max-width:100% !important; margin:0 !important; padding:0 !important; }
  
  .btn-group {
    gap: 0.2rem !important;
    width: 100% !important;
    max-width: 100% !important;
    justify-content: center !important;
  }
  
  .quick-controls { gap:0.3rem !important; width:100% !important; max-width:100% !important; margin:0 !important; padding:0 !important; }
  
  .quick-controls .btn { font-size:0.55rem !important; padding:0.25rem 0.35rem !important; min-width:40px !important; margin:0.1rem !important; flex:1 1 auto !important; }
  
  .side-panels .panel-content .form-control {
    min-width: 80px !important;
    font-size: 0.7rem !important;
    padding: 0.3rem 0.4rem !important;
  }
  
  .side-panels .panel-content .btn {
    padding: 0.25rem 0.4rem !important;
    font-size: 0.6rem !important;
    min-width: 35px !important;
  }
  
  .corruptor-panel .panel-content { padding:0.5rem 0.75rem !important; }
  
  .corruptor-panel .form-control,
  .corruptor-panel .form-select {
    font-size: 0.7rem !important;
    padding: 0.3rem 0.4rem !important;
  }
  
  .status-chip {
    padding: 0.2rem 0.4rem !important;
    font-size: 0.55rem !important;
  }
  
  .overlay-status {
    font-size: 0.6rem !important;
  }
  
  /* Make table even more compact */
  table.rom-table {
    font-size: 0.6rem !important;
  }
  
  table.rom-table th,
  table.rom-table td {
    padding: 0.2rem 0.3rem !important;
  }
  
  .table-responsive {
    max-height: 180px !important;
  }
  
  /* Force all Bootstrap columns to full width and fix corruptor */
  .col, .col-12, .col-sm-5, .col-sm-7, .col-6 { flex:0 0 100% !important; max-width:100% !important; width:100% !important; padding-left:0.25rem !important; padding-right:0.25rem !important; }
  
  /* Override Bootstrap row margins */
  .row { margin-left:0 !important; margin-right:0 !important; width:100% !important; max-width:100% !important; }
  
  .row > * { padding-left:0.25rem !important; padding-right:0.25rem !important; }
  
  /* Fix corruptor card specifically */
  /* legacy corruptor card container removed */
  
  .corruptor-panel .row .col-12,
  .corruptor-panel .row .col-sm-5,
  .corruptor-panel .row .col-sm-7 { flex:0 0 100% !important; max-width:100% !important; width:100% !important; margin-bottom:0.5rem !important; }

  /* Final clamp pass */
  .nes-grid, .play-area, .screen-shell, .screen-aspect, .quick-controls, .btn-toolbar, .btn-group, .side-panels, .card.corruptor, .panel-content, .status-bar { max-width:100vw !important; }
}

/* ================= Top Emulator Button Restyle (match Reload aesthetic) ================= */
/* Goal: thick (3px) outline, transparent base, fill with color on hover/focus, keep existing color palette */
/* We override earlier definitions (including custom rf/fmc/save/load styles) with higher-specificity selectors placed later in file. */
.quick-controls .btn-group .btn.btn-success,
.quick-controls .btn-group .btn.btn-warning,
.quick-controls .btn-group .btn.btn-danger,
.quick-controls .btn-group .btn.btn-rf,
.quick-controls .btn-group .btn.btn-fmc,
.quick-controls .btn-group .btn.btn-load-state,
.quick-controls .btn-group .btn.btn-save-state {
  border-width:3px !important;
  background:transparent !important;
  box-shadow:none !important;
  position:relative;
  font-weight:700;
  letter-spacing:.5px;
  text-transform:uppercase;
  transition:background .16s ease, color .16s ease, box-shadow .16s ease, transform .12s ease;
}

/* Styled selects (RF/FMC) inherit button look */
.quick-controls .btn-group .btn-select { 
  appearance:none; -webkit-appearance:none; -moz-appearance:none;
  cursor:pointer; 
  padding-right:2.4rem !important; 
  min-width:92px; 
  font-size:.8rem; 
  line-height:1.15; 
  background:#0d1117 !important; /* solid dark so system focus styles don't invert text */
  color:inherit; 
  position:relative; 
  border-radius:0 !important; 
  padding:.55rem .85rem .50rem .75rem !important; 
  font-weight:700; 
}
.quick-controls .btn-group .btn-select option { background:#0d1117; color:#e6edf3; font-size:.75rem; }
.quick-controls .btn-group .btn-select:focus { outline:none; box-shadow:0 0 0 3px rgba(79,163,255,.35); }
.quick-controls .btn-group .btn-fmc.btn-select:focus { box-shadow:0 0 0 3px rgba(62,198,226,.35); }
/* Force text color to remain themed (avoid turning black on focus in some browsers) */
.quick-controls .btn-group select.btn-rf.btn-select,
.quick-controls .btn-group select.btn-rf.btn-select:focus,
.quick-controls .btn-group select.btn-rf.btn-select:active { color:#4fa3ff !important; -webkit-text-fill-color:#4fa3ff; }
.quick-controls .btn-group select.btn-fmc.btn-select,
.quick-controls .btn-group select.btn-fmc.btn-select:focus,
.quick-controls .btn-group select.btn-fmc.btn-select:active { color:#3ec6e2 !important; -webkit-text-fill-color:#3ec6e2; }
.quick-controls .btn-group .btn-select:disabled { opacity:.45; }
/* Custom arrow using layered background (works on selects cross-browser) */
.quick-controls .btn-group .btn-select {
  background-image:
    linear-gradient(45deg, currentColor 50%, transparent 51%),
    linear-gradient(135deg, currentColor 50%, transparent 51%),
    linear-gradient(currentColor,currentColor);
  background-position:
  calc(100% - 1.05rem) calc(50% - 4px),
  calc(100% - 0.75rem) calc(50% - 4px),
  calc(100% - 0.9rem) 50%;
  background-size:6px 6px, 6px 6px, 1px 65%;
  background-repeat:no-repeat;
}
/* Preserve hover fill behaviors while keeping arrow visible */
.quick-controls .btn-group .btn-rf.btn-select:hover:not(:disabled),
.quick-controls .btn-group .btn-rf.btn-select:focus-visible { background-color:#13202c !important; }
.quick-controls .btn-group .btn-fmc.btn-select:hover:not(:disabled),
.quick-controls .btn-group .btn-fmc.btn-select:focus-visible { background-color:#102228 !important; }
/* Larger on very small screens adjust proportionally */
@media (max-width:599px){
  .quick-controls .btn-group .btn-select { min-width:78px; font-size:.7rem; padding-right:2rem !important; }
}


/* Base color assignments (outline + text). We rely on existing CSS variables / color codes already used earlier */
.quick-controls .btn-group .btn.btn-success { color:var(--nes-success); border-color:var(--nes-success); }
.quick-controls .btn-group .btn.btn-warning { color:var(--nes-secondary); border-color:var(--nes-secondary); }
.quick-controls .btn-group .btn.btn-danger { color:#ff4757; border-color:#ff4757; }
.quick-controls .btn-group .btn.btn-rf { color:#4fa3ff; border-color:#4fa3ff; }
.quick-controls .btn-group .btn.btn-fmc { color:#3ec6e2; border-color:#3ec6e2; }
.quick-controls .btn-group .btn.btn-save-state { color:#ff7546; border-color:#ff5a26; }
.quick-controls .btn-group .btn.btn-load-state { color:#ffe48a; border-color:#ffd84d; }

/* Hover / focus: fill with color (or gradient similar to original) and invert text for readability */
.quick-controls .btn-group .btn.btn-success:hover:not(:disabled),
.quick-controls .btn-group .btn.btn-success:focus-visible { background:linear-gradient(45deg,var(--nes-success),#00f5d4); color:#0a1915; box-shadow:0 0 0 3px rgba(6,195,155,.35); }
.quick-controls .btn-group .btn.btn-warning:hover:not(:disabled),
.quick-controls .btn-group .btn.btn-warning:focus-visible { background:linear-gradient(45deg,var(--nes-secondary),#ffb84d); color:#1b1202; box-shadow:0 0 0 3px rgba(201,122,6,.35); }
.quick-controls .btn-group .btn.btn-danger:hover:not(:disabled),
.quick-controls .btn-group .btn.btn-danger:focus-visible { background:linear-gradient(45deg,#ff4757,#ff6b8a); color:#180305; box-shadow:0 0 0 3px rgba(255,71,87,.35); }
.quick-controls .btn-group .btn.btn-rf:hover:not(:disabled),
.quick-controls .btn-group .btn.btn-rf:focus-visible { background:#4fa3ff; color:#031421; box-shadow:0 0 0 3px rgba(79,163,255,.45); }
.quick-controls .btn-group .btn.btn-fmc:hover:not(:disabled),
.quick-controls .btn-group .btn.btn-fmc:focus-visible { background:#3ec6e2; color:#041b20; box-shadow:0 0 0 3px rgba(62,198,226,.45); }
.quick-controls .btn-group .btn.btn-save-state:hover:not(:disabled),
.quick-controls .btn-group .btn.btn-save-state:focus-visible { background:#ff5a26; color:#1c0702; box-shadow:0 0 0 3px rgba(255,90,38,.45); }
.quick-controls .btn-group .btn.btn-load-state:hover:not(:disabled),
.quick-controls .btn-group .btn.btn-load-state:focus-visible { background:#ffd84d; color:#211800; box-shadow:0 0 0 3px rgba(255,216,77,.45); }

/* Active press subtle depth */
.quick-controls .btn-group .btn:active:not(:disabled) { transform:translateY(1px); filter:brightness(1.02); }

/* Disabled clarity */
.quick-controls .btn-group .btn:disabled { opacity:.45; filter:grayscale(.25); cursor:not-allowed; }

/* Tighten padding slightly for uniform feel with thicker borders */
.quick-controls .btn-group .btn { padding:0.45rem 0.75rem; }

/* Icon-only Start/Pause/Reset buttons */
.quick-controls .btn-group .ctrl-btn { display:inline-flex; align-items:center; justify-content:center; padding:0.5rem 0.6rem; position:relative; }
.quick-controls .btn-group .ctrl-btn .ctrl-ico { width:20px; height:20px; display:block; stroke:currentColor; stroke-width:0; }
.quick-controls .btn-group .ctrl-btn .ctrl-ico.play polygon { stroke:currentColor; stroke-width:6; stroke-linejoin:round; }
.quick-controls .btn-group .ctrl-btn .ctrl-ico.pause rect { stroke:currentColor; stroke-width:4; }
.quick-controls .btn-group .ctrl-btn .ctrl-ico.reset path:first-of-type { stroke:currentColor; fill:none; }
.quick-controls .btn-group .ctrl-btn .ctrl-ico.reset path:last-of-type { stroke:none; }
@media (max-width:599px){
  .quick-controls .btn-group .ctrl-btn { padding:0.4rem 0.45rem; }
  .quick-controls .btn-group .ctrl-btn .ctrl-ico { width:18px; height:18px; }
}

@media (max-width:599px){
  .quick-controls .btn-group .btn { padding:0.35rem 0.55rem; }
}


